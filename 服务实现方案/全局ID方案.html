<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title> | Manuals For Developers</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><meta name="generator" content="Hexo 4.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Manuals For Developers</h1><a id="logo" href="/.">Manuals For Developers</a><p class="description"></p></div><div id="nav-menu"><a href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title"></h1><div class="post-content"><h3 id="一、原始的Snowflake算法"><a href="#一、原始的Snowflake算法" class="headerlink" title="一、原始的Snowflake算法"></a>一、原始的Snowflake算法</h3><p><img src="/uploads/976d0f8142d72d9acb0de62fd53db256/image.png" alt="image"></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-number">0</span>  <span class="hljs-number">1</span>位，符号位，不使用<br>x0000000<span class="hljs-number">-00000000</span><span class="hljs-number">-00000000</span><span class="hljs-number">-00000000</span><span class="hljs-number">-00000000</span><span class="hljs-number">-00</span>  <span class="hljs-number">41</span>位，时间戳<br>xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xx000000<span class="hljs-number">-0000</span>  <span class="hljs-number">10</span>位机器ID+进程ID <br>xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxx0000<span class="hljs-number">-00000000</span>  <span class="hljs-number">12</span>位序列号<br></code></pre></td></tr></table></figure>
<p>缺点：无法保证唯一性</p>
<h3 id="二、改进的Snowflake算法"><a href="#二、改进的Snowflake算法" class="headerlink" title="二、改进的Snowflake算法"></a>二、改进的Snowflake算法</h3><p>//此处应该有张图</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-number">0</span>  <span class="hljs-number">1</span>位，符号位，不使用<br>x0000000<span class="hljs-number">-00000000</span><span class="hljs-number">-00000000</span><span class="hljs-number">-00000000</span><span class="hljs-number">-00000000</span><span class="hljs-number">-00</span>  <span class="hljs-number">41</span>位，时间戳<br>xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xx000000<span class="hljs-number">-00000000</span><span class="hljs-number">-00</span>  <span class="hljs-number">16</span>位IP地址，取IPv4地址后<span class="hljs-number">16</span>位，取值范围：xxx.xxx<span class="hljs-number">.0</span><span class="hljs-number">-255.0</span><span class="hljs-number">-255</span><br>xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xx000000  <span class="hljs-number">6</span>位序列号，<span class="hljs-number">0</span><span class="hljs-number">-63</span><br></code></pre></td></tr></table></figure>

<h4 id="1、唯一性，依赖IP地址及单进程启动"><a href="#1、唯一性，依赖IP地址及单进程启动" class="headerlink" title="1、唯一性，依赖IP地址及单进程启动"></a>1、唯一性，依赖IP地址及单进程启动</h4><h4 id="2、理论每秒生成64000个不同ID"><a href="#2、理论每秒生成64000个不同ID" class="headerlink" title="2、理论每秒生成64000个不同ID"></a>2、理论每秒生成64000个不同ID</h4><h4 id="3、不可使用本地ip，127开头"><a href="#3、不可使用本地ip，127开头" class="headerlink" title="3、不可使用本地ip，127开头"></a>3、不可使用本地ip，127开头</h4><h4 id="4、同一时间戳序号不大于63"><a href="#4、同一时间戳序号不大于63" class="headerlink" title="4、同一时间戳序号不大于63"></a>4、同一时间戳序号不大于63</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//rpc config</span><br><span class="hljs-keyword">return</span> [<br>    <span class="hljs-string">'swoole'</span> =&gt; [<br>        <span class="hljs-string">'host'</span> =&gt; <span class="hljs-string">'swoole-rpc'</span>,<br>    ]<br>];<br><br><span class="hljs-comment">//rpc call</span><br>$result = \Core\Rpc\Client::getInstance()-&gt;call(<span class="hljs-string">'swoole'</span>, [<span class="hljs-string">'globalId'</span>]);<br><span class="hljs-keyword">echo</span> json_encode($result); <span class="hljs-comment">//&#123;"code":0,"msg":"","data":"6516216470152675648"&#125;</span><br></code></pre></td></tr></table></figure>

<p>缺点：每台机器只能单进程生成ID</p>
<h3 id="三、多机房的Snowflake算法"><a href="#三、多机房的Snowflake算法" class="headerlink" title="三、多机房的Snowflake算法"></a>三、多机房的Snowflake算法</h3><p>//此处应该有张图</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-number">0</span>  <span class="hljs-number">1</span>位，符号位，不使用<br>x0000000<span class="hljs-number">-00000000</span><span class="hljs-number">-00000000</span><span class="hljs-number">-00000000</span><span class="hljs-number">-00000000</span><span class="hljs-number">-00</span>  <span class="hljs-number">41</span>位，时间戳<br>xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xx0000  <span class="hljs-number">4</span>位机房ID，<span class="hljs-number">0</span><span class="hljs-number">-15</span>，最多<span class="hljs-number">16</span>个机房<br>xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxx00<span class="hljs-number">-00000000</span><span class="hljs-number">-00</span>  <span class="hljs-number">12</span>位IP地址，取IPv4地址后<span class="hljs-number">12</span>位，取值范围：xxx.xxx<span class="hljs-number">.0</span><span class="hljs-number">-15.0</span><span class="hljs-number">-255</span><br>xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xx000000  <span class="hljs-number">6</span>位序列号，<span class="hljs-number">0</span><span class="hljs-number">-63</span><br></code></pre></td></tr></table></figure>

<p>缺点：IPv4地址第三段必须限制在0-15，如172.18.<strong><em>15</em></strong>.3</p>
</div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://xgoteam.com/manuals_for_it_developers"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Manuals For Developers.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script><script type="text/javascript" id="maid-script" src="https://unpkg.com/mermaid@8.4/dist/mermaid.min.js?v=0.0.0"></script><script>if (window.mermaid) {
  var options = JSON.parse(document.getElementById('maid-script').getAttribute('mermaidoptioins'));
  mermaid.initialize(options);
}</script></div></body></html>